# 
# HyperSec XDR Vector Component Template
# Purpose: Transform file that parses message field as JSON
# Deployment Types: AWS, SaaS
# Release Date: 2024-03-27
# CT Build: Â© HyperSec 2024
# 
# Required environment variables:
# - _101_TRANSFORM_FLATTEN_MESSAGE_INPUT: Dynamic input set in the container as an env variable;

transforms:
  101_transform_flatten_message_parse:
    type: remap
    inputs: ${_101_TRANSFORM_FLATTEN_MESSAGE_INPUT:?err}
    source:  |

      . = parse_json(.message) ?? {}

  101_transform_flatten_message:
    type: filter
    inputs:
      - 101_transform_flatten_message_parse
    condition:
      type: "vrl"
      source: "!is_empty(.)"